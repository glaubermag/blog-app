var M=t=>{throw TypeError(t)};var S=(t,e,r)=>e.has(t)||M("Cannot "+r);var i=(t,e,r)=>(S(t,e,"read from private field"),r?r.call(t):e.get(t)),j=(t,e,r)=>e.has(t)?M("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,r),v=(t,e,r,a)=>(S(t,e,"write to private field"),a?a.call(t,r):e.set(t,r),r),k=(t,e,r)=>(S(t,e,"access private method"),r);import{S as z,s as B,h as R,g as G,n as K,u as D,r as h,j as s,a as H,L as J,b as X}from"./index-UFVZZzOX.js";import{n as Y,s as Z,u as P,E as F,P as _,c as ee,b as te,d as se,e as re}from"./ErrorMessage-DI2h2iUx.js";var b,y,n,c,m,C,O,I,ae=(I=class extends z{constructor(e,r){super();j(this,m);j(this,b);j(this,y);j(this,n);j(this,c);v(this,b,e),this.setOptions(r),this.bindMethods(),k(this,m,C).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){var a;const r=this.options;this.options=i(this,b).defaultMutationOptions(e),B(this.options,r)||i(this,b).getMutationCache().notify({type:"observerOptionsUpdated",mutation:i(this,n),observer:this}),r!=null&&r.mutationKey&&this.options.mutationKey&&R(r.mutationKey)!==R(this.options.mutationKey)?this.reset():((a=i(this,n))==null?void 0:a.state.status)==="pending"&&i(this,n).setOptions(this.options)}onUnsubscribe(){var e;this.hasListeners()||(e=i(this,n))==null||e.removeObserver(this)}onMutationUpdate(e){k(this,m,C).call(this),k(this,m,O).call(this,e)}getCurrentResult(){return i(this,y)}reset(){var e;(e=i(this,n))==null||e.removeObserver(this),v(this,n,void 0),k(this,m,C).call(this),k(this,m,O).call(this)}mutate(e,r){var a;return v(this,c,r),(a=i(this,n))==null||a.removeObserver(this),v(this,n,i(this,b).getMutationCache().build(i(this,b),this.options)),i(this,n).addObserver(this),i(this,n).execute(e)}},b=new WeakMap,y=new WeakMap,n=new WeakMap,c=new WeakMap,m=new WeakSet,C=function(){var r;const e=((r=i(this,n))==null?void 0:r.state)??G();v(this,y,{...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset})},O=function(e){K.batch(()=>{var r,a,l,o,g,p,w,u;if(i(this,c)&&this.hasListeners()){const x=i(this,y).variables,f=i(this,y).context;(e==null?void 0:e.type)==="success"?((a=(r=i(this,c)).onSuccess)==null||a.call(r,e.data,x,f),(o=(l=i(this,c)).onSettled)==null||o.call(l,e.data,null,x,f)):(e==null?void 0:e.type)==="error"&&((p=(g=i(this,c)).onError)==null||p.call(g,e.error,x,f),(u=(w=i(this,c)).onSettled)==null||u.call(w,void 0,e.error,x,f))}this.listeners.forEach(x=>{x(i(this,y))})})},I);function ie(t,e){const r=D(),[a]=h.useState(()=>new ae(r,t));h.useEffect(()=>{a.setOptions(t)},[a,t]);const l=h.useSyncExternalStore(h.useCallback(g=>a.subscribe(K.batchCalls(g)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),o=h.useCallback((g,p)=>{a.mutate(g,p).catch(Y)},[a]);if(l.error&&Z(a.options.throwOnError,[l.error]))throw l.error;return{...l,mutate:o,mutateAsync:l.mutate}}const oe=({comment:t,onChange:e,onSubmit:r,isLoading:a})=>{const l=o=>{o.preventDefault(),r(t)};return s.jsxs("form",{onSubmit:l,className:"space-y-4 mb-8",children:[s.jsxs("div",{children:[s.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Nome"}),s.jsx("input",{type:"text",id:"name",value:t.name,onChange:o=>e({...t,name:o.target.value}),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 transition-colors",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Email"}),s.jsx("input",{type:"email",id:"email",value:t.email,onChange:o=>e({...t,email:o.target.value}),className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 transition-colors",required:!0})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"body",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Comentário"}),s.jsx("textarea",{id:"body",value:t.body,onChange:o=>e({...t,body:o.target.value}),rows:4,className:"w-full px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500 dark:focus:ring-blue-400 transition-colors",required:!0})]}),s.jsx("button",{type:"submit",disabled:a,className:"w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:a?"Enviando...":"Enviar Comentário"})]})},ne=({comments:t})=>t.length===0?s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Nenhum comentário ainda. Seja o primeiro a comentar!"})}):s.jsx("div",{className:"space-y-6",children:t.map(e=>s.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:s.jsxs("div",{className:"flex items-start space-x-3",children:[s.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center flex-shrink-0",children:s.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300 font-medium",children:e.name.charAt(0)})}),s.jsxs("div",{className:"flex-1",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),s.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:e.email})]}),s.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-300",children:e.body})]})]})},e.id))}),he=()=>{const{id:t}=H(),[e,r]=h.useState(null),[a,l]=h.useState([]),o=parseInt(t||"0"),g=D(),[p,w]=h.useState({name:"",email:"",body:""}),{data:u,isLoading:x,error:f}=P({queryKey:["post",o],queryFn:()=>te(o)}),{data:A,isLoading:U,error:Q}=P({queryKey:["author",u==null?void 0:u.userId],queryFn:()=>se((u==null?void 0:u.userId)||0),enabled:!!(u!=null&&u.userId)}),{data:N=[],isLoading:$,error:T}=P({queryKey:["comments",o],queryFn:()=>re(o)}),q=ie({mutationFn:d=>ee(o,d),onSuccess:d=>{g.setQueryData(["comments",o],L=>{const E={...d,id:Date.now(),postId:o};return[...L||[],E]}),w({name:"",email:"",body:""})}}),V=d=>{q.mutate(d)};return h.useEffect(()=>{async function d(){const E=await(await fetch(`https://jsonplaceholder.typicode.com/users/${t}`)).json();r(E);const W=await(await fetch(`https://jsonplaceholder.typicode.com/posts?userId=${t}`)).json();l(W)}d()},[t]),x||U||$?s.jsx(J,{}):f||Q||T?s.jsx(F,{message:"Erro ao carregar o post. Por favor, tente novamente mais tarde."}):!u||!A?s.jsx(F,{message:"Post não encontrado."}):s.jsxs("div",{className:"container mx-auto p-4",children:[s.jsx(X,{to:"/",className:"text-blue-500 underline mb-4 inline-block",children:"← Voltar para a lista"}),e&&s.jsxs("h1",{className:"text-3xl font-bold mb-4",children:["Posts de ",e.name]}),s.jsx("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:a.map(d=>s.jsx(_,{post:d,author:e||void 0},d.id))}),s.jsx("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:s.jsxs("div",{className:"p-6",children:[s.jsxs("h2",{className:"text-2xl font-semibold text-gray-800 dark:text-white mb-6",children:["Comentários (",(N==null?void 0:N.length)||0,")"]}),s.jsx(oe,{comment:p,onChange:w,onSubmit:V,isLoading:q.isPending}),s.jsx(ne,{comments:N||[]})]})})]})};export{he as default};
