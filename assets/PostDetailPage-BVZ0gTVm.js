var F=s=>{throw TypeError(s)};var S=(s,t,a)=>t.has(s)||F("Cannot "+a);var n=(s,t,a)=>(S(s,t,"read from private field"),a?a.call(s):t.get(s)),v=(s,t,a)=>t.has(s)?F("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(s):t.set(s,a),f=(s,t,a,r)=>(S(s,t,"write to private field"),r?r.call(s,a):t.set(s,a),a),N=(s,t,a)=>(S(s,t,"access private method"),a);import{S as W,s as z,h as I,g as B,n as V,u as D,r as w,j as e,a as G,R as H,b as y,L as K}from"./index-5Qpmec92.js";import{n as J,s as X,u as O,E as q,U as R,c as Y,b as Z,d as _,e as $}from"./ErrorMessage-yU7XkylX.js";var u,g,o,x,h,E,L,T,ee=(T=class extends W{constructor(t,a){super();v(this,h);v(this,u);v(this,g);v(this,o);v(this,x);f(this,u,t),this.setOptions(a),this.bindMethods(),N(this,h,E).call(this)}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){var r;const a=this.options;this.options=n(this,u).defaultMutationOptions(t),z(this.options,a)||n(this,u).getMutationCache().notify({type:"observerOptionsUpdated",mutation:n(this,o),observer:this}),a!=null&&a.mutationKey&&this.options.mutationKey&&I(a.mutationKey)!==I(this.options.mutationKey)?this.reset():((r=n(this,o))==null?void 0:r.state.status)==="pending"&&n(this,o).setOptions(this.options)}onUnsubscribe(){var t;this.hasListeners()||(t=n(this,o))==null||t.removeObserver(this)}onMutationUpdate(t){N(this,h,E).call(this),N(this,h,L).call(this,t)}getCurrentResult(){return n(this,g)}reset(){var t;(t=n(this,o))==null||t.removeObserver(this),f(this,o,void 0),N(this,h,E).call(this),N(this,h,L).call(this)}mutate(t,a){var r;return f(this,x,a),(r=n(this,o))==null||r.removeObserver(this),f(this,o,n(this,u).getMutationCache().build(n(this,u),this.options)),n(this,o).addObserver(this),n(this,o).execute(t)}},u=new WeakMap,g=new WeakMap,o=new WeakMap,x=new WeakMap,h=new WeakSet,E=function(){var a;const t=((a=n(this,o))==null?void 0:a.state)??B();f(this,g,{...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset})},L=function(t){V.batch(()=>{var a,r,d,i,l,p,j,C;if(n(this,x)&&this.hasListeners()){const m=n(this,g).variables,b=n(this,g).context;(t==null?void 0:t.type)==="success"?((r=(a=n(this,x)).onSuccess)==null||r.call(a,t.data,m,b),(i=(d=n(this,x)).onSettled)==null||i.call(d,t.data,null,m,b)):(t==null?void 0:t.type)==="error"&&((p=(l=n(this,x)).onError)==null||p.call(l,t.error,m,b),(C=(j=n(this,x)).onSettled)==null||C.call(j,void 0,t.error,m,b))}this.listeners.forEach(m=>{m(n(this,g))})})},T);function te(s,t){const a=D(),[r]=w.useState(()=>new ee(a,s));w.useEffect(()=>{r.setOptions(s)},[r,s]);const d=w.useSyncExternalStore(w.useCallback(l=>r.subscribe(V.batchCalls(l)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),i=w.useCallback((l,p)=>{r.mutate(l,p).catch(J)},[r]);if(d.error&&X(r.options.throwOnError,[d.error]))throw d.error;return{...d,mutate:i,mutateAsync:d.mutate}}const se=({comment:s,onChange:t,onSubmit:a,isLoading:r,postId:d})=>{const i=l=>{l.preventDefault(),a({...s,postId:d})};return e.jsxs("form",{onSubmit:i,className:"space-y-4","data-testid":"comment-form",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700",children:"Nome"}),e.jsx("input",{type:"text",id:"name",value:s.name,onChange:l=>t({...s,name:l.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700",children:"Email"}),e.jsx("input",{type:"email",id:"email",value:s.email,onChange:l=>t({...s,email:l.target.value}),className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"body",className:"block text-sm font-medium text-gray-700",children:"Comentário"}),e.jsx("textarea",{id:"body",value:s.body,onChange:l=>t({...s,body:l.target.value}),rows:3,className:"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm",required:!0})]}),e.jsx("div",{children:e.jsx("button",{type:"submit",disabled:r,className:"inline-flex justify-center rounded-md border border-transparent bg-indigo-600 py-2 px-4 text-sm font-medium text-white shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 disabled:opacity-50",children:r?"Enviando...":"Enviar Comentário"})})]})},ae=({comments:s})=>s.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Nenhum comentário ainda. Seja o primeiro a comentar!"})}):e.jsx("div",{className:"space-y-6",children:s.map(t=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300 font-medium",children:t.name.charAt(0)})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.email})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-300",children:t.body})]})]})},t.id))}),le=()=>{const{id:s}=G(),t=parseInt(s||"0"),a=D(),[r,d]=H.useState({name:"",email:"",body:""}),{data:i,isLoading:l,error:p}=O({queryKey:["post",t],queryFn:()=>Z(t),gcTime:1e3*60*30,staleTime:1e3*60*5}),{data:j,isLoading:C,error:m}=O({queryKey:["author",i==null?void 0:i.userId],queryFn:()=>_((i==null?void 0:i.userId)||0),enabled:!!(i!=null&&i.userId),gcTime:1e3*60*30,staleTime:1e3*60*5,retry:(c,k)=>k instanceof R?!1:c<3}),{data:b=[],isLoading:U,error:A}=O({queryKey:["comments",t],queryFn:()=>$(t).then(c=>c.sort((k,P)=>P.id-k.id)),gcTime:1e3*60*30,staleTime:1e3*60*5}),M=te({mutationFn:c=>Y(t,c),onSuccess:c=>{a.setQueryData(["comments",t],k=>[{...c,id:Date.now(),postId:t},...k||[]]),d({name:"",email:"",body:""})}}),Q=c=>{M.mutate(c)};return l?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(y,{to:"/",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mb-4 inline-block",children:"← Voltar para a lista"}),e.jsx(K,{})]})}):p?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(y,{to:"/",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mb-4 inline-block",children:"← Voltar para a lista"}),e.jsx(q,{message:"Erro ao carregar o post. Por favor, tente novamente mais tarde."})]})}):i?C||U?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(y,{to:"/",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mb-4 inline-block",children:"← Voltar para a lista"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:i.title}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.body})]}),e.jsx(K,{})]})}):m instanceof R?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(y,{to:"/",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mb-4 inline-block",children:"← Voltar para a lista"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:i.title}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.body})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Autor não encontrado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Desculpe, não conseguimos encontrar o autor deste post."})]})]})}):m||A?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(y,{to:"/",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mb-4 inline-block",children:"← Voltar para a lista"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:i.title}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.body})]}),e.jsx(q,{message:"Ocorreu um erro ao carregar os dados. Por favor, tente novamente mais tarde."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(y,{to:"/",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mb-4 inline-block",children:"← Voltar para a lista"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:i.title}),j&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-gray-600 dark:text-gray-400",children:["Por: ",j.name]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500 text-sm",children:j.email})]}),e.jsx("p",{className:"text-gray-700 dark:text-gray-300",children:i.body})]}),e.jsxs("section",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:[e.jsxs("h2",{className:"text-2xl font-semibold text-gray-900 dark:text-white mb-6",children:["Comentários (",b.length,")"]}),e.jsx(se,{comment:r,onChange:d,onSubmit:Q,isLoading:M.isPending}),e.jsx(ae,{comments:b})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 py-8 px-4",children:e.jsxs("div",{className:"max-w-3xl mx-auto",children:[e.jsx(y,{to:"/",className:"text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 mb-4 inline-block",children:"← Voltar para a lista"}),e.jsx(q,{message:"Post não encontrado."})]})})};export{le as default};
