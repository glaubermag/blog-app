import{j as e,u as w,r as k,b as C,L as v,c as E,d as P,e as L,f as q,h as S,i as F}from"./index-BB-g2y8g.js";import{u as b,E as p}from"./ErrorMessage-NxobcwJP.js";import{P as O}from"./PostCard-C7wgEX_f.js";const I=({comments:s})=>s.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300",children:"Nenhum comentário ainda. Seja o primeiro a comentar!"})}):e.jsx("div",{className:"space-y-6",children:s.map(t=>e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-600 flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300 font-medium",children:t.name.charAt(0)})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.name}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:t.email})]}),e.jsx("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-300",children:t.body})]})]})},t.id))}),$=({comment:s,onChange:t,onSubmit:j,isLoading:u,postId:r})=>{const{showToast:x=()=>{}}=w()||{},[g,i]=k.useState(!1),[d,f]=k.useState({}),l=n=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n),h=(n,o)=>{const a={...d};switch(n){case"name":o.length<3?a.name="O nome deve ter pelo menos 3 caracteres":delete a.name;break;case"email":l(o)?delete a.email:a.email="Por favor, insira um email válido";break;case"body":o.length<10?a.body="O comentário deve ter pelo menos 10 caracteres":delete a.body;break}return f(a),Object.keys(a).length===0},c=n=>{const{name:o,value:a}=n.target;t({...s,[o]:a}),h(o,a)},y=async n=>{if(n.preventDefault(),Object.keys(s).every(a=>h(a,s[a])))try{await j({...s,postId:r}),x("Comentário enviado com sucesso!","success")}catch{x("Erro ao enviar comentário. Tente novamente.","error")}else x("Por favor, corrija os erros no formulário.","warning")};return e.jsxs("form",{onSubmit:y,className:"space-y-4","data-testid":"comment-form",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Nome"}),e.jsx("input",{type:"text",id:"name",name:"name",value:s.name,onChange:c,className:`mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white ${d.name?"border-red-500":""}`,required:!0}),d.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.name})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Email"}),e.jsx("input",{type:"email",id:"email",name:"email",value:s.email,onChange:c,className:`mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white ${d.email?"border-red-500":""}`,required:!0}),d.email&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.email})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"body",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Comentário"}),e.jsx("textarea",{id:"body",name:"body",value:s.body,onChange:c,rows:3,className:`mt-1 block w-full rounded-md border-gray-300 dark:border-gray-600 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white ${d.body?"border-red-500":""}`,required:!0}),d.body&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:d.body})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>i(!g),className:"text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:g?"Ocultar preview":"Mostrar preview"}),e.jsx("button",{type:"submit",disabled:u||Object.keys(d).length>0,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:u?"Enviando...":"Enviar comentário"})]}),g&&e.jsxs("div",{className:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Preview do comentário:"}),e.jsxs("div",{className:"prose dark:prose-invert max-w-none",children:[e.jsx("p",{className:"text-gray-600 dark:text-gray-300 whitespace-pre-line",children:s.body}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mt-2",children:["— ",s.name]})]})]})]})},T=()=>{const{id:s}=C(),t=parseInt(s||"0",10),[j,u]=k.useState({name:"",email:"",body:""}),{data:r,isLoading:x,error:g}=b({queryKey:["post",t],queryFn:()=>L(t)}),{data:i,isLoading:d,error:f}=b({queryKey:["author",r==null?void 0:r.userId],queryFn:()=>q((r==null?void 0:r.userId)||0),enabled:!!r}),{data:l,isLoading:h,error:c}=b({queryKey:["comments",t],queryFn:()=>S(t),enabled:!!r}),{data:y,isLoading:n}=b({queryKey:["relatedPosts",r==null?void 0:r.userId],queryFn:()=>F((r==null?void 0:r.userId)||0),enabled:!!r}),o=async m=>{try{await P({...m,postId:t})}catch(N){console.error("Erro ao enviar comentário:",N)}};if(x||d||h)return e.jsx(v,{});if(g||f||c)return e.jsx(p,{message:"Erro ao carregar o post. Por favor, tente novamente mais tarde."});if(!r||!i)return e.jsx(p,{message:"Post não encontrado."});const a=(y==null?void 0:y.filter(m=>m.id!==r.id))||[];return e.jsxs("div",{className:"space-y-8",children:[e.jsx("article",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 dark:text-white mb-4",children:r.title}),e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center",children:e.jsx("span",{className:"text-gray-600 dark:text-gray-300 font-medium",children:i.name.charAt(0)})}),e.jsxs("div",{children:[e.jsx(E,{to:`/author/${i.id}`,className:"text-sm font-medium text-gray-700 dark:text-gray-200 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:i.name}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:i.company.name})]})]}),e.jsx("div",{className:"prose dark:prose-invert max-w-none",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-300 whitespace-pre-line",children:r.body})})]})}),a.length>0&&e.jsxs("section",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:["Outros posts de ",i.name]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.slice(0,3).map(m=>e.jsx(O,{post:m,author:i},m.id))})]}),e.jsxs("section",{className:"space-y-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 dark:text-white",children:["Comentários (",(l==null?void 0:l.length)||0,")"]}),e.jsx($,{comment:j,onChange:u,onSubmit:o,isLoading:!1,postId:t}),h?e.jsx(v,{}):c?e.jsx(p,{message:"Erro ao carregar os comentários."}):e.jsx(I,{comments:l||[]})]})]})};export{T as default};
